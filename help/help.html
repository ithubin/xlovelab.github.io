{% extends "base/base.html" %}
{% load staticfiles %}
{% block head %}
    <script src="{% static "application/bower_components/d3/d3.js" %}" type="text/javascript"></script>

    <style>
        svg {
            display: block;
            margin: auto;
        }

        .node {
            cursor: pointer;
        }

        .node circle {
            fill: #fff;
            stroke: steelblue;
            stroke-width: 3px;
        }

        .node text {
            font-size: x-large;
            stroke: black;
        }

        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 3px;
        }

        .href:hover {
            text-decoration: none;
        }
    </style>
{% endblock %}

{% block content %}
    <div id="template-default">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <div class="page-header">
                        <h1><a href="/application/">系统帮助</a><a href="../about/" class="pull-right btn">关于</a></h1>
                    </div>
                </div>
            </div>
            <div class="row" id="help">
            </div>
        </div>
    </div>
{% endblock %}

{% block tail %}
    <script type="text/javascript">
        $('a.btn').each(function (data) {
            $(this).addClass(BTN_CLASS[parseInt(5 * Math.random())]);
        });

        var width = $('#help').width();
        var height = width * 0.618;

        var color = d3.scale.category20();

        var cluster = d3.layout.cluster()
                .size([width, height - 360]);

        var diagonal = d3.svg.diagonal()
                .projection(function (d) {
                    return [d.x, d.y];
                });

        var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(0,120)");

        d3.json("/static/application/x/data/tree.json", function (error, root) {
            if (error) throw error;

            var nodes = cluster.nodes(root),
                    links = cluster.links(nodes);

            var link = svg.selectAll(".link")
                    .data(links)
                    .enter().append("path")
                    .attr("class", "link")
                    .attr("d", diagonal);

            var node = svg.selectAll(".node")
                    .data(nodes)
                    .enter().append("a")
                    .attr("xlink:href", function (d) {
                        return d.url;
                    })
                    .attr("class", "href")
                    .append("g")
                    .attr("class", "node")
                    .attr("transform", function (d) {
                        return "translate(" + d.x + "," + d.y + ")";
                    });

            node.append("circle")
                    .attr("r", 6)
                    .style("stroke", function (d) {
                        return color(d.level);
                    });

            node.append("text")
                    .attr("dx", 0)
                    .attr("dy", 0)
                    .attr("transform", function (d) {
                        return d.children ? "translate(45, -16)" : "rotate(90)translate(16, 8)";
                    })
                    .attr("text-anchor", function (d) {
                        return d.children ? "end" : "start";
                    })
                    .text(function (d) {
                        return d.name;
                    });
        });

    </script>
{% endblock %}
